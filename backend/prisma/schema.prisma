generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         Int      @id @default(autoincrement())
  username   String   @unique
  password   String
  adminUser  Boolean  @default(false)
  dcClose    Boolean  @default(false)
  isActive   Boolean  @default(true)
  isDeleted  Boolean  @default(false)
  deletedAt  DateTime?
  deletedBy  Int?
  concernIds Int[]    @default([])
  canAdd     Boolean  @default(false)
  canEdit    Boolean  @default(false)
  canDelete  Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  
  userTenants UserTenant[]
  
  @@map("users")
}

model Tenant {
  id           Int     @id @default(autoincrement())
  concernId    Int
  financialYear String
  isActive     Boolean @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  concern     Concern @relation(fields: [concernId], references: [id])
  userTenants UserTenant[]
  masters     Master[]
  fabricInwards FabricInwardHeader[]
  
  @@unique([concernId, financialYear])
  @@map("tenants")
}

model UserTenant {
  id       Int @id @default(autoincrement())
  userId   Int
  tenantId Int
  
  user   User   @relation(fields: [userId], references: [id])
  tenant Tenant @relation(fields: [tenantId], references: [id])
  
  @@unique([userId, tenantId])
  @@map("user_tenants")
}

model Party {
  id            Int      @id @default(autoincrement())
  partyName     String   @db.VarChar(50)
  partyCode     String?  @db.VarChar(50)
  address1      String?  @db.VarChar(50)
  address2      String?  @db.VarChar(50)
  address3      String?  @db.VarChar(50)
  address4      String?  @db.VarChar(50)
  pincode       String?  @db.VarChar(8)
  district      String?  @db.VarChar(50)
  state         String?  @db.VarChar(50)
  mobileNo      String?  @db.VarChar(10)
  phoneNo       String?  @db.VarChar(10)
  email         String?  @db.VarChar(100)
  panNo         String?  @db.VarChar(10)
  tallyAccName  String?  @db.VarChar(50)
  gstNo         String?  @db.VarChar(15)
  creditDays    Int      @default(0)
  accountNo     String?  @db.VarChar(30)
  bank          String?  @db.VarChar(30)
  ifscCode      String?  @db.VarChar(12)
  branch        String?  @db.VarChar(30)
  active        Int      @default(1)
  isDeleted     Boolean  @default(false)
  deletedAt     DateTime?
  deletedBy     Int?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  contacts   PartyContact[]
  partyTypes PartyPartyType[]
  designs    Design[]
  
  @@map("parties")
}

model PartyContact {
  id               Int     @id @default(autoincrement())
  partyId          Int
  name             String? @db.VarChar(50)
  mobileNo         String? @db.VarChar(10)
  email            String? @db.VarChar(100)
  whatsappRequired Int     @default(0)
  mailRequired     Int     @default(0)
  
  party Party @relation(fields: [partyId], references: [id], onDelete: Cascade)
  
  @@map("party_contacts")
}

model Concern {
  id            Int      @id @default(autoincrement())
  partyName     String   @db.VarChar(50)
  vendorCode    String?  @db.VarChar(50)
  address1      String?  @db.VarChar(50)
  address2      String?  @db.VarChar(50)
  address3      String?  @db.VarChar(50)
  address4      String?  @db.VarChar(50)
  pincode       String?  @db.VarChar(8)
  district      String?  @db.VarChar(50)
  state         String?  @db.VarChar(50)
  mobileNo      String?  @db.VarChar(10)
  phoneNo       String?  @db.VarChar(10)
  email         String?  @db.VarChar(100)
  panNo         String?  @db.VarChar(10)
  tallyAccName  String?  @db.VarChar(50)
  gstNo         String?  @db.VarChar(15)
  creditDays    Int      @default(0)
  accountNo     String?  @db.VarChar(30)
  bank          String?  @db.VarChar(30)
  ifscCode      String?  @db.VarChar(12)
  branch        String?  @db.VarChar(30)
  active        Int      @default(1)
  isDeleted     Boolean  @default(false)
  deletedAt     DateTime?
  deletedBy     Int?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
 
  contacts ConcernContact[]
  tenants  Tenant[]
  fabricInwards FabricInwardHeader[]
 
  @@map("concerns")
}

model ConcernContact {
  id               Int     @id @default(autoincrement())
  concernId        Int
  name             String? @db.VarChar(50)
  mobileNo         String? @db.VarChar(10)
  email            String? @db.VarChar(100)
  whatsappRequired Int     @default(0)
  mailRequired     Int     @default(0)
 
  concern Concern @relation(fields: [concernId], references: [id], onDelete: Cascade)
 
  @@map("concern_contacts")
}

model PartyType {
  id            Int      @id @default(autoincrement())
  partyTypeName String   @db.VarChar(50)
  isActive      Boolean  @default(true)
  isDeleted     Boolean  @default(false)
  deletedAt     DateTime?
  deletedBy     Int?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  parties PartyPartyType[]
  
  @@map("party_types")
}

model PartyPartyType {
  id          Int @id @default(autoincrement())
  partyId     Int
  partyTypeId Int
  
  party     Party     @relation(fields: [partyId], references: [id], onDelete: Cascade)
  partyType PartyType @relation(fields: [partyTypeId], references: [id], onDelete: Cascade)
  
  @@unique([partyId, partyTypeId])
  @@map("party_party_types")
}

model Process {
  id                 Int      @id @default(autoincrement())
  processName        String   @unique @db.VarChar(100)
  tallyName          String?  @db.VarChar(100)
  category           String   @db.VarChar(50)
  productionExcess   Decimal  @default(0) @db.Decimal(5, 2)
  isActive           Boolean  @default(true)
  notRequiredRate    Boolean  @default(false)
  wetCondition       Boolean  @default(false)
  isDeleted          Boolean  @default(false)
  deletedAt          DateTime?
  deletedBy          Int?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  
  @@map("processes")
}


model Design {
  id              Int      @id @default(autoincrement())
  refNo           String?  @db.VarChar(50)
  date            DateTime @default(now())
  customerId      Int?
  designNo        String   @db.VarChar(50)
  designName      String   @db.VarChar(100)
  typeOfPrint     String?  @db.VarChar(50)
  noOfColor       Int      @default(1)
  noOfPrint       Int      @default(1)
  commercialRate  Decimal  @default(0) @db.Decimal(10, 2)
  description     String?  @db.Text
  remarks         String?  @db.Text
  imagePath       String?  @db.VarChar(255)
  isActive        Boolean  @default(true)
  isDeleted       Boolean  @default(false)
  deletedAt       DateTime?
  deletedBy       Int?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  customer Party? @relation(fields: [customerId], references: [id])
  fabricInwardDetails FabricInwardDetail[]
  
  @@map("designs")
}

model PartyProcessRateSetting {
  id            Int      @id @default(autoincrement())
  partyId       Int
  processId     Int
  ratePerKg     Decimal  @default(0) @db.Decimal(12, 2)
  ratePerPiece  Decimal  @default(0) @db.Decimal(12, 2)
  minAmount     Decimal  @default(0) @db.Decimal(12, 2)
  minKgsProcess Decimal  @default(0) @db.Decimal(12, 3)
  isDeleted     Boolean  @default(false)
  deletedAt     DateTime?
  deletedBy     Int?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@map("party_process_rate_settings")
}

model Master {
  id          Int      @id @default(autoincrement())
  tenantId    Int
  masterType  String   @db.VarChar(50)
  masterName  String   @db.VarChar(100)
  isActive    Boolean  @default(true)
  isDeleted   Boolean  @default(false)
  deletedAt   DateTime?
  deletedBy   Int?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  tenant Tenant @relation(fields: [tenantId], references: [id])
  fabricDetails FabricInwardDetail[] @relation("FabricMaster")
  colorDetails FabricInwardDetail[] @relation("ColorMaster")
  diaDetails FabricInwardDetail[] @relation("DiaMaster")
  uomDetails FabricInwardDetail[] @relation("UOMMaster")
  
  @@map("masters")
}

model FabricInwardHeader {
  id              Int      @id @default(autoincrement())
  tenantId        Int
  grnNo           String   @db.VarChar(10)
  grnDate         DateTime @default(now())
  partyId         Int?
  pdcNo           String?  @db.VarChar(50)
  pdcDate         DateTime?
  dyeingPartyId   Int?
  dyeingDcNo      String?  @db.VarChar(50)
  dyeingDcDate    DateTime?
  orderNo         String?  @db.VarChar(50)
  poNo            String?  @db.VarChar(50)
  dcType          String   @default("Fresh") @db.VarChar(20)
  fabricType      String   @default("Grey Lot") @db.VarChar(20)
  remarks         String?  @db.VarChar(100)
  vehicleNo       String?  @db.VarChar(20)
  totalQty        Decimal  @default(0) @db.Decimal(12, 3)
  totalRolls      Int      @default(0)
  createdBy       String?  @db.VarChar(50)
  createdDate     DateTime @default(now())
  modifiedBy      String?  @db.VarChar(50)
  modifiedDate    DateTime @updatedAt
  deletedBy       String?  @db.VarChar(50)
  deletedDate     DateTime?
  deleteFlg       Int      @default(0)
  yearId          Int?
  concernId       Int?
  sortOrder       Int?
  isClosed        Int      @default(0)
  
  tenant    Tenant                 @relation(fields: [tenantId], references: [id])
  concern   Concern?               @relation(fields: [concernId], references: [id])
  details   FabricInwardDetail[]
  processes FabricInwardProcess[]
  
  @@map("fabric_inward_headers")
}

model FabricInwardDetail {
  id                    Int      @id @default(autoincrement())
  headerId              Int
  fabricId              Int?
  colorId               Int?
  diaId                 Int?
  gsm                   String?  @db.VarChar(100)
  designId              Int?
  designName            String?  @db.VarChar(100)
  noOfColor             Int?
  productionNotRequired Int      @default(0)
  weight                Decimal  @default(0) @db.Decimal(12, 3)
  rolls                 Int      @default(0)
  uomId                 Int?
  remarks               String?  @db.VarChar(100)
  deleteFlg             Int      @default(0)
  
  header FabricInwardHeader @relation(fields: [headerId], references: [id], onDelete: Cascade)
  design Design?               @relation(fields: [designId], references: [id])
  fabric Master?               @relation("FabricMaster", fields: [fabricId], references: [id])
  color  Master?               @relation("ColorMaster", fields: [colorId], references: [id])
  dia    Master?               @relation("DiaMaster", fields: [diaId], references: [id])
  uom    Master?               @relation("UOMMaster", fields: [uomId], references: [id])
  
  @@map("fabric_inward_details")
}

model FabricInwardProcess {
  id                    Int      @id @default(autoincrement())
  headerId              Int
  processName           String   @db.VarChar(100)
  rate                  Decimal  @default(0) @db.Decimal(12, 2)
  wetCondition          Int      @default(0)
  productionNotRequired Int      @default(0)
  productionClose       Int      @default(0)
  deleteFlg             Int      @default(0)
  
  header FabricInwardHeader @relation(fields: [headerId], references: [id], onDelete: Cascade)
  
  @@map("fabric_inward_processes")
}
