generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  password  String
  adminUser Boolean  @default(false)
  dcClose   Boolean  @default(false)
  isActive  Boolean  @default(true)
  isDeleted Boolean  @default(false)
  deletedAt DateTime?
  deletedBy Int?
  concernId Int?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  userTenants UserTenant[]
  concern     Concern? @relation(fields: [concernId], references: [id])
  
  @@map("users")
}

model Tenant {
  id           Int     @id @default(autoincrement())
  concernId    Int
  financialYear String
  isActive     Boolean @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  concern     Concern @relation(fields: [concernId], references: [id])
  userTenants UserTenant[]
  
  @@unique([concernId, financialYear])
  @@map("tenants")
}

model UserTenant {
  id       Int @id @default(autoincrement())
  userId   Int
  tenantId Int
  
  user   User   @relation(fields: [userId], references: [id])
  tenant Tenant @relation(fields: [tenantId], references: [id])
  
  @@unique([userId, tenantId])
  @@map("user_tenants")
}

model Party {
  id            Int      @id @default(autoincrement())
  partyName     String   @db.VarChar(50)
  partyCode     String   @db.VarChar(50)
  address1      String?  @db.VarChar(50)
  address2      String?  @db.VarChar(50)
  address3      String?  @db.VarChar(50)
  address4      String?  @db.VarChar(50)
  pincode       String?  @db.VarChar(8)
  district      String?  @db.VarChar(50)
  state         String?  @db.VarChar(50)
  mobileNo      String?  @db.VarChar(10)
  phoneNo       String?  @db.VarChar(10)
  email         String?  @db.VarChar(20)
  panNo         String?  @db.VarChar(20)
  tallyAccName  String?  @db.VarChar(50)
  gstNo         String   @db.VarChar(50)
  creditDays    Int      @default(0)
  accountNo     String?  @db.VarChar(30)
  bank          String?  @db.VarChar(30)
  ifscCode      String?  @db.VarChar(12)
  branch        String?  @db.VarChar(30)
  active        Int      @default(1)
  isDeleted     Boolean  @default(false)
  deletedAt     DateTime?
  deletedBy     Int?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  contacts   PartyContact[]
  partyTypes PartyPartyType[]
  
  @@map("parties")
}

model PartyContact {
  id               Int     @id @default(autoincrement())
  partyId          Int
  name             String  @db.VarChar(50)
  mobileNo         String? @db.VarChar(10)
  email            String? @db.VarChar(20)
  whatsappRequired Int     @default(0)
  mailRequired     Int     @default(0)
  
  party Party @relation(fields: [partyId], references: [id], onDelete: Cascade)
  
  @@map("party_contacts")
}

model Concern {
  id            Int      @id @default(autoincrement())
  partyName     String   @db.VarChar(50)
  vendorCode    String?  @db.VarChar(50)
  address1      String?  @db.VarChar(50)
  address2      String?  @db.VarChar(50)
  address3      String?  @db.VarChar(50)
  address4      String?  @db.VarChar(50)
  pincode       String?  @db.VarChar(8)
  district      String?  @db.VarChar(50)
  state         String?  @db.VarChar(50)
  mobileNo      String?  @db.VarChar(10)
  phoneNo       String?  @db.VarChar(10)
  email         String?  @db.VarChar(20)
  panNo         String?  @db.VarChar(20)
  tallyAccName  String?  @db.VarChar(50)
  gstNo         String   @db.VarChar(50)
  creditDays    Int      @default(0)
  accountNo     String?  @db.VarChar(30)
  bank          String?  @db.VarChar(30)
  ifscCode      String?  @db.VarChar(12)
  branch        String?  @db.VarChar(30)
  active        Int      @default(1)
  isDeleted     Boolean  @default(false)
  deletedAt     DateTime?
  deletedBy     Int?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  contacts ConcernContact[]
  tenants  Tenant[]
  users    User[]
  
  @@map("concerns")
}

model ConcernContact {
  id               Int     @id @default(autoincrement())
  concernId        Int
  name             String  @db.VarChar(50)
  mobileNo         String? @db.VarChar(10)
  email            String? @db.VarChar(20)
  whatsappRequired Int     @default(0)
  mailRequired     Int     @default(0)
  
  concern Concern @relation(fields: [concernId], references: [id], onDelete: Cascade)
  
  @@map("concern_contacts")
}

model PartyType {
  id            Int      @id @default(autoincrement())
  partyTypeName String   @db.VarChar(50)
  isActive      Boolean  @default(true)
  isDeleted     Boolean  @default(false)
  deletedAt     DateTime?
  deletedBy     Int?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  parties PartyPartyType[]
  
  @@map("party_types")
}

model PartyPartyType {
  id          Int @id @default(autoincrement())
  partyId     Int
  partyTypeId Int
  
  party     Party     @relation(fields: [partyId], references: [id], onDelete: Cascade)
  partyType PartyType @relation(fields: [partyTypeId], references: [id], onDelete: Cascade)
  
  @@unique([partyId, partyTypeId])
  @@map("party_party_types")
}
