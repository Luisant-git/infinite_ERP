generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         Int      @id @default(autoincrement())
  username   String   @unique
  password   String
  adminUser  Boolean  @default(false)
  dcClose    Boolean  @default(false)
  isActive   Boolean  @default(true)
  isDeleted  Boolean  @default(false)
  deletedAt  DateTime?
  deletedBy  Int?
  concernIds Int[]    @default([])
  canAdd     Boolean  @default(false)
  canEdit    Boolean  @default(false)
  canDelete  Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  
  userTenants UserTenant[]
  
  @@map("users")
}

model Tenant {
  id           Int     @id @default(autoincrement())
  concernId    Int
  financialYear String
  isActive     Boolean @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  concern     Concern @relation(fields: [concernId], references: [id])
  userTenants UserTenant[]
  
  @@unique([concernId, financialYear])
  @@map("tenants")
}

model UserTenant {
  id       Int @id @default(autoincrement())
  userId   Int
  tenantId Int
  
  user   User   @relation(fields: [userId], references: [id])
  tenant Tenant @relation(fields: [tenantId], references: [id])
  
  @@unique([userId, tenantId])
  @@map("user_tenants")
}

model Party {
  id            Int      @id @default(autoincrement())
  partyName     String   @db.VarChar(50)
  partyCode     String?  @db.VarChar(50)
  address1      String?  @db.VarChar(50)
  address2      String?  @db.VarChar(50)
  address3      String?  @db.VarChar(50)
  address4      String?  @db.VarChar(50)
  pincode       String?  @db.VarChar(8)
  district      String?  @db.VarChar(50)
  state         String?  @db.VarChar(50)
  mobileNo      String?  @db.VarChar(10)
  phoneNo       String?  @db.VarChar(10)
  email         String?  @db.VarChar(100)
  panNo         String?  @db.VarChar(10)
  tallyAccName  String?  @db.VarChar(50)
  gstNo         String?  @db.VarChar(15)
  creditDays    Int      @default(0)
  accountNo     String?  @db.VarChar(30)
  bank          String?  @db.VarChar(30)
  ifscCode      String?  @db.VarChar(12)
  branch        String?  @db.VarChar(30)
  active        Int      @default(1)
  isDeleted     Boolean  @default(false)
  deletedAt     DateTime?
  deletedBy     Int?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  contacts   PartyContact[]
  partyTypes PartyPartyType[]
  designs    Design[]
  
  @@map("parties")
}

model PartyContact {
  id               Int     @id @default(autoincrement())
  partyId          Int
  name             String? @db.VarChar(50)
  mobileNo         String? @db.VarChar(10)
  email            String? @db.VarChar(100)
  whatsappRequired Int     @default(0)
  mailRequired     Int     @default(0)
  
  party Party @relation(fields: [partyId], references: [id], onDelete: Cascade)
  
  @@map("party_contacts")
}

model Concern {
  id            Int      @id @default(autoincrement())
  partyName     String   @db.VarChar(50)
  vendorCode    String?  @db.VarChar(50)
  address1      String?  @db.VarChar(50)
  address2      String?  @db.VarChar(50)
  address3      String?  @db.VarChar(50)
  address4      String?  @db.VarChar(50)
  pincode       String?  @db.VarChar(8)
  district      String?  @db.VarChar(50)
  state         String?  @db.VarChar(50)
  mobileNo      String?  @db.VarChar(10)
  phoneNo       String?  @db.VarChar(10)
  email         String?  @db.VarChar(100)
  panNo         String?  @db.VarChar(10)
  tallyAccName  String?  @db.VarChar(50)
  gstNo         String?  @db.VarChar(15)
  creditDays    Int      @default(0)
  accountNo     String?  @db.VarChar(30)
  bank          String?  @db.VarChar(30)
  ifscCode      String?  @db.VarChar(12)
  branch        String?  @db.VarChar(30)
  active        Int      @default(1)
  isDeleted     Boolean  @default(false)
  deletedAt     DateTime?
  deletedBy     Int?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
 
  contacts ConcernContact[]
  tenants  Tenant[]
 
  @@map("concerns")
}

model ConcernContact {
  id               Int     @id @default(autoincrement())
  concernId        Int
  name             String? @db.VarChar(50)
  mobileNo         String? @db.VarChar(10)
  email            String? @db.VarChar(100)
  whatsappRequired Int     @default(0)
  mailRequired     Int     @default(0)
 
  concern Concern @relation(fields: [concernId], references: [id], onDelete: Cascade)
 
  @@map("concern_contacts")
}

model PartyType {
  id            Int      @id @default(autoincrement())
  partyTypeName String   @db.VarChar(50)
  isActive      Boolean  @default(true)
  isDeleted     Boolean  @default(false)
  deletedAt     DateTime?
  deletedBy     Int?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  parties PartyPartyType[]
  
  @@map("party_types")
}

model PartyPartyType {
  id          Int @id @default(autoincrement())
  partyId     Int
  partyTypeId Int
  
  party     Party     @relation(fields: [partyId], references: [id], onDelete: Cascade)
  partyType PartyType @relation(fields: [partyTypeId], references: [id], onDelete: Cascade)
  
  @@unique([partyId, partyTypeId])
  @@map("party_party_types")
}

model Process {
  id                 Int      @id @default(autoincrement())
  processName        String   @unique @db.VarChar(100)
  tallyName          String?  @db.VarChar(100)
  category           String   @db.VarChar(50)
  productionExcess   Decimal  @default(0) @db.Decimal(5, 2)
  isActive           Boolean  @default(true)
  notRequiredRate    Boolean  @default(false)
  wetCondition       Boolean  @default(false)
  isDeleted          Boolean  @default(false)
  deletedAt          DateTime?
  deletedBy          Int?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  
  @@map("processes")
}


model Design {
  id              Int      @id @default(autoincrement())
  refNo           String?  @db.VarChar(50)
  date            DateTime @default(now())
  customerId      Int?
  designNo        String   @db.VarChar(50)
  designName      String   @db.VarChar(100)
  typeOfPrint     String?  @db.VarChar(50)
  noOfColor       Int      @default(1)
  noOfPrint       Int      @default(1)
  commercialRate  Decimal  @default(0) @db.Decimal(10, 2)
  description     String?  @db.Text
  remarks         String?  @db.Text
  imagePath       String?  @db.VarChar(255)
  isActive        Boolean  @default(true)
  isDeleted       Boolean  @default(false)
  deletedAt       DateTime?
  deletedBy       Int?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  customer Party? @relation(fields: [customerId], references: [id])
  
  @@map("designs")
}

model PartyProcessRateSetting {
  id            Int      @id @default(autoincrement())
  partyId       Int
  processId     Int
  ratePerKg     Decimal  @default(0) @db.Decimal(12, 2)
  ratePerPiece  Decimal  @default(0) @db.Decimal(12, 2)
  minAmount     Decimal  @default(0) @db.Decimal(12, 2)
  minKgsProcess Decimal  @default(0) @db.Decimal(12, 3)
  isDeleted     Boolean  @default(false)
  deletedAt     DateTime?
  deletedBy     Int?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@map("party_process_rate_settings")
}
